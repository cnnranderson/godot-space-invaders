[gd_scene load_steps=5 format=2]

[ext_resource path="res://utils/SubdivideSprite.gd" type="Script" id=1]
[ext_resource path="res://images/star_bg_large.png" type="Texture" id=2]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform vec2 Direction = vec2(-1.0, 0.0);
uniform float ScrollSpeed = 0.02;
uniform float CycleSpeed = 0.5;
uniform bool AutoCycle = true;
uniform vec4 Dusk_Gradient_Bottom = vec4(0.87843, 0.64314, 0.43137, 1.0);
uniform vec4 Day_Gradient_Bottom = vec4(0.08627, 0.02745, 0.07059, 1.0); //vec4(0.79, 0.96, 1.0, 1.0);
uniform vec4 Day_Gradient_Top = vec4(0.21961, 0.43922, 0.74510, 1.0); //vec4(0.21, 0.84, 0.93, 1.0);

void fragment()
{
	// Calc the current gradient time
	float i_time = abs(sin(CycleSpeed * TIME));
	
	// Scroll the main texture horizontally
	COLOR = texture(TEXTURE, UV + Direction * ScrollSpeed * TIME);
	
	// Create the gradient for daytime sky colors
	vec4 col = vec4(0, 0, 0, 1);
	col = Day_Gradient_Bottom + (UV.y * ((i_time * Day_Gradient_Top) + ((1.0 - i_time) * Dusk_Gradient_Bottom)));
	
	
	// Cycle between day/night over time
	COLOR -= (i_time * (COLOR - col));
}

void vertex()
{
	// Stretch vertical UV
	VERTEX.y += UV.y * 100.0;
	
	// Apply curve
	float height = 0.0015 * pow(VERTEX.x - 320.0, 2.0) - 100.0;
	VERTEX.y += height;
	
	// Slightly stretch the horizontal UV
	VERTEX.x += UV.x * 320.0 - 160.0;
}



"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/Direction = Vector2( -1, 0 )
shader_param/ScrollSpeed = 0.02
shader_param/CycleSpeed = 0.5
shader_param/AutoCycle = true
shader_param/Dusk_Gradient_Bottom = Plane( 0.87843, 0.64314, 0.43137, 1 )
shader_param/Day_Gradient_Bottom = Plane( 0.08627, 0.02745, 0.07059, 1 )
shader_param/Day_Gradient_Top = Plane( 0.21961, 0.43922, 0.7451, 1 )

[node name="Sky" type="Node2D"]
material = SubResource( 2 )
position = Vector2( 320, 240 )
script = ExtResource( 1 )
texture = ExtResource( 2 )
resolution = 32
