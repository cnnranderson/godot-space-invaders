[gd_scene load_steps=5 format=2]

[ext_resource path="res://utils/SubdivideSprite.gd" type="Script" id=1]
[ext_resource path="res://images/star_bg_large.png" type="Texture" id=2]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform vec2 Direction = vec2(-1.0, 0.0);
uniform float Speed = 0.02;

void fragment()
{
	// Scroll the main texture horizontally
	COLOR = texture(TEXTURE, UV + Direction * TIME * Speed);
	
	// Create the gradient for daytime sky colors
	vec4 grad_1 = vec4(0.79, 0.96, 1.0, 1.0);
	vec4 grad_2 = vec4(0.21, 0.84, 0.93, 1.0);
	vec4 col = grad_1 + (UV.y * (grad_2 - grad_1));
	
	// Cycle between day/night over time
	COLOR = col + (abs(sin(0.5 * TIME)) * (COLOR - col));
}

void vertex()
{
	// Stretch vertical UV
	VERTEX.y += UV.y * 100.0;
	
	// Apply curve
	float height = 0.0015 * pow(VERTEX.x - 320.0, 2.0) - 100.0;
	VERTEX.y += height;
	
	// Slightly stretch the horizontal UV
	VERTEX.x += UV.x * 320.0 - 160.0;
}"

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/Direction = Vector2( -1, 0 )
shader_param/Speed = 0.02

[node name="Sky" type="Node2D"]
material = SubResource( 2 )
position = Vector2( 320, 240 )
script = ExtResource( 1 )
texture = ExtResource( 2 )
resolution = 32
